---
title: "Trabalho 1- Estatística Não paramétrica"
author: "Cristiane Huang Zhu"
format: html
editor: visual
---

# Ex 1- Seja X ∼ Bernoulli(1/2) e considere todas as possíveis amostras aleatórias de tamanho n = 4. Calcule Xn e S2n para cada uma das dezesseis amostras. Encontre a função de probabilidade de Xn e S2n.

Amostras possíveis

```{r}
# valores 0 ou 1 e tamanho 4
amostras <- expand.grid(rep(list(c(0,1)),4))
amostras
```

Para fazer o cálculo da média e variância amostral foi feito primeiro uma função para cada uma delas e depois foi aplicada as funções para as amostras usando apply.

```{r}
# Média amostral
media <- function(x) {
  mean(x)
}

# Variância amostral
variancia <- function(x) {
  var(x)
} 

# Calcular a média e variancia para as amostras
media_amostral<- apply(amostras, 1, media) # aplicar na lista amostra, por linha e aplicar a função media
media_amostral

variancia_amostral <- apply(amostras, 1, variancia)
variancia_amostral
```

Para encontrar a função de probabilidade da média e da variância foi utilizado table para contar a frequência que ocorre cada valor distinto e depois foi dividido por 16, o número de amostras totais.

```{r}
# Função de probabilidade da média e variância amostral
f_prob_media <- table(media_amostral)/16
f_prob_media

f_prob_var <- table(variancia_amostral)/16
f_prob_var
```

# Ex 2- (a) Escreva uma função R para encontrar estimativas de ∆(F,G) considerando valores diversos de tamanhos de cada amostra

```{r}
# Função phi- estimador não viciado de g(F,G) (enunciado)
phi <- function(x1, x2, y1, y2) {
  if (max(x1, x2) < min(y1, y2) || max(y1, y2) < min(x1, x2)) {
    return(1)
  } else {
    return(0)
  }
}

# Função para calcular U-estatística U(X, Y)- estimador não viciado de mínima variãncia

u_estat <- function(x, y){ 
  
  #todas as combinações possíveis de x em grupos de 2 (y tbm)
  comb_x <- combn(x, 2, simplify = FALSE)
  comb_y <- combn(y, 2, simplify = FALSE)
  
  soma <- 0
  contagem <- 0
  
  for (x_par in comb_x) {
    for (y_par in comb_y) {
      soma <- soma + phi(x_par[1], x_par[2], y_par[1], y_par[2])
      contagem <- contagem + 1
    }
  }
  
  u <- soma / contagem
  return(u)
}

# Estimador não viciado de mínima variância delta(F,G):
delta <- function(X, Y) {
  valor_u <- u_estat(X, Y)
  return((1/2) * valor_u - 1/6)
}
```

## (b) Gere amostras de tamanho 50,100 e 150 das distribuições (i) Normal padrão,(ii) Cauchy padrão e (iii) t-Student(4). Considere estas como possíveis distribuições de referência.

Para amostras de distribuição Normal padrão foi utlizado a função rnorm, para a distribuição Cauchy padrão rcauchy e para a t-student foi utilizado rt.

```{r}
set.seed(123)
# Amostras de tamanho 50,100,150 para normal padrão
np1 <- rnorm(50, mean = 0, sd = 1) 
tabela_np1 <-data.frame(np1)
print(tabela_np1)

np2 <- rnorm(100, mean = 0, sd = 1)
tabela_np2 <-data.frame(np2)
print(tabela_np2)

np3 <- rnorm(150, mean = 0, sd = 1) 
tabela_np3 <-data.frame(np3)
print(tabela_np3)

# Cauchy padrão
cp1 <- rcauchy(50, location=0, scale=1)
tabela_cp1 <-data.frame(cp1)
print(tabela_cp1)

cp2 <- rcauchy(100, location=0, scale=1)
tabela_cp2 <-data.frame(cp2)
print(tabela_cp2)

cp3 <- rcauchy(150, location=0, scale=1)
tabela_cp3 <-data.frame(cp3)
print(tabela_cp3)

# t-student
ts1 <- rt(50, df=4)
tabela_ts1 <-data.frame(ts1)
print(tabela_ts1)

ts2 <- rt(100, df=4)
tabela_ts2 <-data.frame(ts2)
print(tabela_ts2)

ts3 <- rt(150, df=4)
tabela_ts3 <-data.frame(ts3)
print(tabela_ts3)
```

## Calcule as estimativas de ∆( b F, G) para cada amostra das distribuições de referência F obtidas no item (b) e a amostra da distribuição desconhecida G, obtida no arquivo de dados anexo.

Para calcular as estimativas para as amostras encontradas anteriormente e as amostras desconhecidas, foi utilizada a função mapply, combinando a função delta criada na letra a e as amostras.

```{r}
require(data.table)
dados <- fread("Trabalho_Lucambio/dados.csv")
G <- dados[[1]]

a <- delta(tabela_np1[[1]], G)
b <- delta(tabela_np2[[1]], G)
c <- delta(tabela_np3[[1]], G)

d <- delta(tabela_cp1[[1]], G)
e <- delta(tabela_cp2[[1]], G)
f <- delta(tabela_cp3[[1]], G)

g <- delta(tabela_ts1[[1]], G)
h <- delta(tabela_ts2[[1]], G)
i <- delta(tabela_ts3[[1]], G)

print(a)

```

# (d) Segundo seus cálculos, qual é a distribuição desconhecida G?

Primeiro, fiz a média dos resultados para cada distribuição para depois comparar os valores. A distribuição desconhecida de G é a distribuição Cauchy padrão pois é a que apresentou menor valor médio de delta F e G ,ou seja, indica mais similaridade entre as distribuições (Os valores da média da normal padrão, cauchy padrão e t-student são respectivamente, 0.00177, -0.00246 e -0.00201).

```{r}
media_np <- mean(c(a,b,c))
media_cp <- mean(c(d,e,f))
media_ts <- mean(c(g,h,i))

print(media_np)
print(media_cp)
print(media_ts)
```

# Ex 3- Encontre o estimador não viciado de mínima variância de:

## Letra a- Esperança do produto

```{r}
#sendo x e y amostras independentes

## E(xy)= E(x)*E(y)
estimador_esp <- function(x,y) {
  media_x <- mean(x)
  media_y <- mean(y)
  e_x_y <- media_x*media_y
  return(e_x_y)
}
```

## Letra b- Variância da soma de x e y

```{r}
estimador_var <- function(x,y) {
  var_x <- var(x) 
  var_y <- var(y)
  
  estimativa <- var_y + var_x
  return(estimativa)
}
```

# Ex 4

## Dados

```{r}
## dados
phipsi <- read.csv("http://leg.ufpr.br/~lucambio/Nonparam/phipsi.csv", sep = ",", header = TRUE)
x <- phipsi$psi
```

# Função para gerar amostras de tamanho n, a partir da densidade kernel

```{r}
amostra_kernel <- function(x, N=600) {
  h <- bw.nrd(x)
  n<- length(x)
  amostras <- numeric(N)
  for (j in 1:N) {
    i <- sample(1:n, 1)
    amostras[j] <- rnorm(1, mean = x[i], sd = h)
  }
  
  return(amostras)
}
```

```{r}
# Amostra de tamanho N=600
set.seed(123)
a <- amostra_kernel(x, N=600)
```

#Comparação gráfica Através da comparação gráfica, foi possível verificar que a densidade da nova amostra acompanha as curvas da densidade original, apenas com pequenas variações no tamanho da curva. Logo, eles possuem um comportamento parecido.

```{r}
x <- phipsi$psi
densidade_x <- density(x)
densidade_amostra <- density(a)

limites_x <- range(c(densidade_x$x, densidade_amostra$x))

# Comparação gráfica
hist(a, probability = TRUE, breaks=30,
     col = "lightgrey",
     main = "Comparação entre as Densidades",
     xlab = "psi",
     xlim= limites_x)
lines(densidade_x, col = "purple", lwd = 2)              # densidade estimada original
lines(densidade_amostra, col = "darkblue", lwd = 2)  # densidade da amostra tam 600
legend("topright", legend = c("Original", "Amostra 600"), col = c("purple", "darkblue"), lwd = 2, cex=0.5)
```
